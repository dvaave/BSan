<!-- HTML header for doxygen 1.8.17-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<link rel="shortcut icon" type="image/x-icon" href="favicon.ico"/>
<title>DynamoRIO: Callstack Walking</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">DynamoRIO
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('page_drcallstack.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Callstack Walking </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The <code>drcallstack</code> DynamoRIO Callstack Walker provides clients with walking of the application callstack.</p>
<ul>
<li><a class="el" href="page_drcallstack.html#sec_drcallstack_setup">Setup</a></li>
<li><a class="el" href="page_drcallstack.html#sec_drcallstack_usage">Usage</a></li>
<li><a class="el" href="page_drcallstack.html#sec_drcallstack_limits">Limitations</a></li>
</ul>
<h1><a class="anchor" id="sec_drcallstack_setup"></a>
Setup</h1>
<p>To use <code>drcallstack</code> with your client simply include this line in your client's <code>CMakeLists.txt</code> file:</p>
<div class="fragment"><div class="line">use_DynamoRIO_extension(clientname drcallstack) </div>
</div><!-- fragment --><p>That will automatically set up the include path and library dependence.</p>
<p>The initialization routine <code><a class="el" href="group__drcallstack.html#ga31c32040f286785f9664f6c62ae08556">drcallstack_init()</a></code> must be called prior to any of the other routines. Additional calls to <a class="el" href="group__drcallstack.html#ga31c32040f286785f9664f6c62ae08556">drcallstack_init()</a> are allowed (so long as they are paired with corresponding calls to <a class="el" href="group__drcallstack.html#ga038658586e669f77edcaa00e909ca4a2">drcallstack_exit()</a>).</p>
<h1><a class="anchor" id="sec_drcallstack_usage"></a>
Usage</h1>
<p>To produce a callstack, first a <a class="el" href="dr__defines_8h.html#ab55fe2529e760adfd88197d0246bc074">dr_mcontext_t</a> with the PC field and all general-purpose registers filled in with application values (i.e., <a class="el" href="dr__defines_8h.html#af0434595b47158e7512c2bf5f0e43ae4ab7914092947d4a374f4a95e089870218">DR_MC_CONTROL</a> | <a class="el" href="dr__defines_8h.html#af0434595b47158e7512c2bf5f0e43ae4af2252e055eafe402a7bf12b9951410d8">DR_MC_INTEGER</a>) must be obtained. When using a custom clean call, the PC field must be explicitly set by the client (typically by passing the application address of the next instruction to the clean call) as it is not set in that case by <a class="el" href="dr__ir__utils_8h.html#a9e348b2596b8750ce3fad234ab022ced">dr_get_mcontext()</a>.</p>
<p>Next, call <a class="el" href="group__drcallstack.html#ga9a2346358eb956377884f73c4b5a5ba7">drcallstack_init_walk()</a> to set up for a walk. Then repeatedly call <a class="el" href="group__drcallstack.html#ga5b274ad73bbffb2eee937352ec858b60">drcallstack_next_frame()</a> to iterate over the frames of the callstack. When <a class="el" href="group__drcallstack.html#gga0c7dbd333e7a1cf017ca334da047f13aaefa373d98252e90ef9021139c2ff054c">DRCALLSTACK_NO_MORE_FRAMES</a> or an error code is returned, clean up with <a class="el" href="group__drcallstack.html#ga4e2f81293edac4fac055e6f05049a8ef">drcallstack_cleanup_walk()</a>.</p>
<p>Here is some example code:</p>
<div class="fragment"><div class="line"><a class="code" href="struct__dr__mcontext__t.html">dr_mcontext_t</a> *mc = <a class="code" href="group__drwrap.html#ga9a33b1049986dd8975e94827f5c0e759">drwrap_get_mcontext</a>(wrapcxt);</div>
<div class="line"><a class="code" href="group__drcallstack.html#ga015c989287af28de0e53b750696947b2">drcallstack_walk_t</a> *walk;</div>
<div class="line"><a class="code" href="group__drcallstack.html#ga0c7dbd333e7a1cf017ca334da047f13a">drcallstack_status_t</a> res = <a class="code" href="group__drcallstack.html#ga9a2346358eb956377884f73c4b5a5ba7">drcallstack_init_walk</a>(mc, &amp;walk);</div>
<div class="line"><a class="code" href="dr__tools_8h.html#a7c07630dffdfd92bc6ee63abf405768c">DR_ASSERT</a>(res == <a class="code" href="group__drcallstack.html#gga0c7dbd333e7a1cf017ca334da047f13aa6766199fd639aa735ace509e742fff7a">DRCALLSTACK_SUCCESS</a>);</div>
<div class="line"><a class="code" href="struct__drcallstack__frame__t.html">drcallstack_frame_t</a> frame = {</div>
<div class="line">    <span class="keyword">sizeof</span>(frame),</div>
<div class="line">};</div>
<div class="line"><span class="keywordtype">int</span> count = 0;</div>
<div class="line">symbolize_pc(<a class="code" href="group__drwrap.html#ga106eb283e97c560a0118b8da211b7f1a">drwrap_get_func</a>(wrapcxt));</div>
<div class="line"><span class="keywordflow">do</span> {</div>
<div class="line">    res = <a class="code" href="group__drcallstack.html#ga5b274ad73bbffb2eee937352ec858b60">drcallstack_next_frame</a>(walk, &amp;frame);</div>
<div class="line">    <span class="keywordflow">if</span> (res != <a class="code" href="group__drcallstack.html#gga0c7dbd333e7a1cf017ca334da047f13aa6766199fd639aa735ace509e742fff7a">DRCALLSTACK_SUCCESS</a>)</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    symbolize_pc(frame.<a class="code" href="struct__drcallstack__frame__t.html#a7f0d66a32e7f4e4cb0cbed90ad4388b3">pc</a>);</div>
<div class="line">    ++count;</div>
<div class="line">} <span class="keywordflow">while</span> (res == <a class="code" href="group__drcallstack.html#gga0c7dbd333e7a1cf017ca334da047f13aa6766199fd639aa735ace509e742fff7a">DRCALLSTACK_SUCCESS</a>);</div>
<div class="line"><a class="code" href="dr__tools_8h.html#a7c07630dffdfd92bc6ee63abf405768c">DR_ASSERT</a>(res == <a class="code" href="group__drcallstack.html#gga0c7dbd333e7a1cf017ca334da047f13aaefa373d98252e90ef9021139c2ff054c">DRCALLSTACK_NO_MORE_FRAMES</a>);</div>
<div class="line">res = <a class="code" href="group__drcallstack.html#ga4e2f81293edac4fac055e6f05049a8ef">drcallstack_cleanup_walk</a>(walk);</div>
<div class="line"><a class="code" href="dr__tools_8h.html#a7c07630dffdfd92bc6ee63abf405768c">DR_ASSERT</a>(res == <a class="code" href="group__drcallstack.html#gga0c7dbd333e7a1cf017ca334da047f13aa6766199fd639aa735ace509e742fff7a">DRCALLSTACK_SUCCESS</a>);</div>
</div><!-- fragment --><h1><a class="anchor" id="sec_drcallstack_limits"></a>
Limitations</h1>
<p>Currently, <code>drcallstack</code> is only implemented for Linux. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div class="ttc" id="astruct__dr__mcontext__t_html"><div class="ttname"><a href="struct__dr__mcontext__t.html">_dr_mcontext_t</a></div><div class="ttdef"><b>Definition:</b> dr_defines.h:765</div></div>
<div class="ttc" id="agroup__drcallstack_html_ga015c989287af28de0e53b750696947b2"><div class="ttname"><a href="group__drcallstack.html#ga015c989287af28de0e53b750696947b2">drcallstack_walk_t</a></div><div class="ttdeci">struct _drcallstack_walk_t drcallstack_walk_t</div><div class="ttdef"><b>Definition:</b> drcallstack.h:85</div></div>
<div class="ttc" id="adr__tools_8h_html_a7c07630dffdfd92bc6ee63abf405768c"><div class="ttname"><a href="dr__tools_8h.html#a7c07630dffdfd92bc6ee63abf405768c">DR_ASSERT</a></div><div class="ttdeci">#define DR_ASSERT(x)</div><div class="ttdef"><b>Definition:</b> dr_tools.h:99</div></div>
<div class="ttc" id="agroup__drcallstack_html_ga9a2346358eb956377884f73c4b5a5ba7"><div class="ttname"><a href="group__drcallstack.html#ga9a2346358eb956377884f73c4b5a5ba7">drcallstack_init_walk</a></div><div class="ttdeci">DR_EXPORT drcallstack_status_t drcallstack_init_walk(dr_mcontext_t *mc, OUT drcallstack_walk_t **walk)</div></div>
<div class="ttc" id="astruct__drcallstack__frame__t_html"><div class="ttname"><a href="struct__drcallstack__frame__t.html">_drcallstack_frame_t</a></div><div class="ttdef"><b>Definition:</b> drcallstack.h:73</div></div>
<div class="ttc" id="agroup__drcallstack_html_ga0c7dbd333e7a1cf017ca334da047f13a"><div class="ttname"><a href="group__drcallstack.html#ga0c7dbd333e7a1cf017ca334da047f13a">drcallstack_status_t</a></div><div class="ttdeci">drcallstack_status_t</div><div class="ttdef"><b>Definition:</b> drcallstack.h:53</div></div>
<div class="ttc" id="astruct__drcallstack__frame__t_html_a7f0d66a32e7f4e4cb0cbed90ad4388b3"><div class="ttname"><a href="struct__drcallstack__frame__t.html#a7f0d66a32e7f4e4cb0cbed90ad4388b3">_drcallstack_frame_t::pc</a></div><div class="ttdeci">app_pc pc</div><div class="ttdef"><b>Definition:</b> drcallstack.h:77</div></div>
<div class="ttc" id="agroup__drwrap_html_ga9a33b1049986dd8975e94827f5c0e759"><div class="ttname"><a href="group__drwrap.html#ga9a33b1049986dd8975e94827f5c0e759">drwrap_get_mcontext</a></div><div class="ttdeci">DR_EXPORT dr_mcontext_t * drwrap_get_mcontext(void *wrapcxt)</div></div>
<div class="ttc" id="agroup__drcallstack_html_gga0c7dbd333e7a1cf017ca334da047f13aa6766199fd639aa735ace509e742fff7a"><div class="ttname"><a href="group__drcallstack.html#gga0c7dbd333e7a1cf017ca334da047f13aa6766199fd639aa735ace509e742fff7a">DRCALLSTACK_SUCCESS</a></div><div class="ttdeci">@ DRCALLSTACK_SUCCESS</div><div class="ttdef"><b>Definition:</b> drcallstack.h:54</div></div>
<div class="ttc" id="agroup__drcallstack_html_gga0c7dbd333e7a1cf017ca334da047f13aaefa373d98252e90ef9021139c2ff054c"><div class="ttname"><a href="group__drcallstack.html#gga0c7dbd333e7a1cf017ca334da047f13aaefa373d98252e90ef9021139c2ff054c">DRCALLSTACK_NO_MORE_FRAMES</a></div><div class="ttdeci">@ DRCALLSTACK_NO_MORE_FRAMES</div><div class="ttdef"><b>Definition:</b> drcallstack.h:55</div></div>
<div class="ttc" id="agroup__drcallstack_html_ga5b274ad73bbffb2eee937352ec858b60"><div class="ttname"><a href="group__drcallstack.html#ga5b274ad73bbffb2eee937352ec858b60">drcallstack_next_frame</a></div><div class="ttdeci">DR_EXPORT drcallstack_status_t drcallstack_next_frame(drcallstack_walk_t *walk, OUT drcallstack_frame_t *frame)</div></div>
<div class="ttc" id="agroup__drcallstack_html_ga4e2f81293edac4fac055e6f05049a8ef"><div class="ttname"><a href="group__drcallstack.html#ga4e2f81293edac4fac055e6f05049a8ef">drcallstack_cleanup_walk</a></div><div class="ttdeci">DR_EXPORT drcallstack_status_t drcallstack_cleanup_walk(drcallstack_walk_t *walk)</div></div>
<div class="ttc" id="agroup__drwrap_html_ga106eb283e97c560a0118b8da211b7f1a"><div class="ttname"><a href="group__drwrap.html#ga106eb283e97c560a0118b8da211b7f1a">drwrap_get_func</a></div><div class="ttdeci">DR_EXPORT app_pc drwrap_get_func(void *wrapcxt)</div></div>
<!-- HTML footer for doxygen 1.8.17-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer" style="float:none;text-align:center"><img border=0 src="favicon.png"> &nbsp;  DynamoRIO version 9.0.1 --- Mon Feb 14 2022 19:04:10 &nbsp; <img border=0 src="favicon.png">
</small></address>
<!--END !GENERATE_TREEVIEW-->
</body>
</html>
