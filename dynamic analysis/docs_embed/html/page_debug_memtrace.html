---
title: "DrCacheSim Offline Trace Debugging"
layout: default
permalink: /page_debug_memtrace.html
---
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">DynamoRIO
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">DrCacheSim Offline Trace Debugging </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This page contains tips for troubleshooting issues when using the <a class="el" href="page_drcachesim.html">DrCacheSim</a> tool's <a class="el" href="sec_drcachesim_offline.html">offline memory address traces</a>.</p>
<h1><a class="anchor" id="autotoc_md132"></a>
Thread Interleaving Granularity</h1>
<p>Each thread has a 32K buffer and when it fills up, or when a system call is about to be executed, the buffer is written out to a per-thread file with a header attached which has a timestamp and cpu identifier. Thus the thread interleaving and cpu scheduling can be reconstructed with a granularity of these buffers.</p>
<h1><a class="anchor" id="autotoc_md133"></a>
Viewing binary trace files</h1>
<h2><a class="anchor" id="autotoc_md134"></a>
Viewing raw, pre-processed files</h2>
<p>Each offline_entry_t struct is 8 bytes, so it's easy to view the records as 8-byte entries:</p>
<div class="fragment"><div class="line">$ od -t x8 -A x drmemtrace.simple_app.09291.0000.dir/raw/drmemtrace.simple_app.09291.0000.raw  | tail</div>
<div class="line">06ed10 200080080007c170 00007fd5a8a49700</div>
<div class="line">06ed20 00007fd5a8a496a8 2000e0080007c187</div>
<div class="line">06ed30 00007ffdee8cd0f8 00007ffdee8cd100</div>
<div class="line">06ed40 00007ffdee8cd108 00007ffdee8cd110</div>
<div class="line">06ed50 00007ffdee8cd118 200060080003c15b</div>
<div class="line">06ed60 200040080003c164 00007ffdee8cd118</div>
<div class="line">06ed70 2000a008000c1180 00007fd5a8a47e68</div>
<div class="line">06ed80 20006008000c11b1 802e9f9036480c5d</div>
<div class="line">06ed90 c100000000000000</div>
<div class="line">06ed98</div>
</div><!-- fragment --><p>Cheat sheet:</p>
<ul>
<li>c000000000000001 is a header (ver 1)</li>
<li>c100000000000000 is a footer</li>
<li>8* is a timestamp</li>
<li>6* is a pid</li>
<li>4* is a tid</li>
<li>2* are PC entries</li>
<li>a* is an arm iflush</li>
<li>c2* is a marker</li>
<li>c203* is a cpu id</li>
<li>c200* is kernel event; c201* is kernel xfer</li>
</ul>
<h2><a class="anchor" id="autotoc_md135"></a>
Viewing post-processed files</h2>
<p>trace_entry_t is 12 bytes and is turned into memref_t by reader_t and its subclasses. To view the 12-byte entries I use <code>od</code> or <code>hexdump</code> to split into 6 2-byte entries and then combine the final 4 into an 8-byte little-endian field using <code>awk</code>:</p>
<div class="fragment"><div class="line">$ zcat drmemtrace.tool.drcacheoff.burst_malloc.211917.2237.dir/trace/drmemtrace.tool.drcacheoff.burst_malloc.211917.8542.trace.gz | od -A x -t x2 -w12 | awk <span class="stringliteral">&#39;{printf &quot;%s | %s %s %s%s%s%s\n&quot;, $1, $2, $3, $7, $6, $5, $4}&#39;</span> | head</div>
<div class="line">000000 | 0019 0000 0000000000000001</div>
<div class="line">00000c | 0016 0004 0000000000033bcd</div>
<div class="line">000018 | 0018 0004 0000000000033bcd</div>
<div class="line">000024 | 001c 0002 002eff22e15562f3</div>
<div class="line">000030 | 001c 0003 0000000000000000</div>
<div class="line">00003c | 000a 0003 0000555ec5db2e40</div>
<div class="line">000048 | 0000 0004 00007ffed4b546ac</div>
</div><!-- fragment --><p>The printed columns are "offset | type size addr". Type cheat sheet (from trace_type_t enum):</p><ul>
<li>0x19 header</li>
<li>0x16 thread</li>
<li>0x18 pid</li>
<li>0x1c marker: 2=timestamp; 3=cpuid</li>
<li>0x0a instr (non-cti)</li>
<li>0x0e direct call</li>
<li>0x00 load</li>
<li>0x01 store</li>
<li>0x1d: non-fetched instr</li>
<li>0x1a footer</li>
</ul>
<p>type_is_instr: 0xa-0x10 + 0x1e</p>
<h2><a class="anchor" id="autotoc_md136"></a>
Viewing instruction disassembly</h2>
<p>You can use the <code>view</code> analysis tool with <code>skip_refs</code> and <code>sim_refs</code> parameters to select a window, or for small traces you can re-post-process with <code>raw2trace</code> with high verbosity (<code>-verbose 4</code> is good). </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.17-->
<!-- start footer part -->
<!--BEGIN GENERATE_TREEVIEW-->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer" style="float:none;text-align:center"><img border=0 src="favicon.png"> &nbsp;  DynamoRIO version 9.0.1 --- Mon Feb 14 2022 19:04:14 &nbsp; <img border=0 src="favicon.png">
</small></address>
